<!DOCTYPE html>
<html lang="en">
	<head>
		<title>The Black Fractal</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="css/main.css">
	</head>

	<body>

		<video id="xenoVideo" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/XenogothikaPromo.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="artScreen01" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/Neurowalker.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="SubstrataScreen" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/mausoleum-large.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="SubstrataScreen001" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/ParadigmPink.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="MonaScreen" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/RainbowGalaxyCluster.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="MonaScreen001" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/Wildcatskylounge.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="DecentralandScreen" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/sakurapagoda.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="DecentralandScreen001" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/5dgallery.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="VoxelsScreen" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/NeoLightningRod.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>
		<video id="VoxelsScreen001" loop crossOrigin="anonymous" playsinline style="display:none">
			<source src="./video/NeonGothicFog.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'>
		</video>

		<!-- Import maps polyfill -->
		<!-- Remove this when import maps will be widely supported -->
		<script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

		<script type="importmap">
			{
				"imports": {
					"three": "../build/three.module.js"
				}
			}
		</script>

		<script type="module">

			import * as THREE from 'three';

			import { OrbitControls } from './examples/jsm/controls/OrbitControls.js';
			import { GLTFLoader } from './examples/jsm/loaders/GLTFLoader.js';
			import { RGBELoader } from './examples/jsm/loaders/RGBELoader.js';
			import { EffectComposer } from './examples/jsm/postprocessing/EffectComposer.js';
			import { RenderPass } from './examples/jsm/postprocessing/RenderPass.js';
			import { UnrealBloomPass } from './examples/jsm/postprocessing/UnrealBloomPass.js';
			import { LightProbeGenerator } from './examples/jsm/lights/LightProbeGenerator.js';

			let camera, scene, renderer, composer;

			let mixer;

			let lightProbe;

			let cubeCamera, cubeRenderTarget;

			let xenoVideo, artScreen01, SubstrataScreen, SubstrataScreen001, MonaScreen, MonaScreen001;
			let DecentralandScreen, DecentralandScreen001, VoxelsScreen, VoxelsScreen001;

			var xenoVideoOn = false;
			var artScreen01On = false;
			var SubstrataScreenOn = false;
			var SubstrataScreen001On = false;
			var MonaScreenOn = false;
			var MonaScreen001On = false;
			var DecentralandScreenOn = false;
			var DecentralandScreen001On = false;
			var VoxelsScreenOn = false;
			var VoxelsScreen001On = false;



			let width, height;

			const raycaster = new THREE.Raycaster();
			const mouse = new THREE.Vector2()


			const API = {
				lightProbeIntensity: 1.0,
				directionalLightIntensity: 0.2,
				envMapIntensity: 1
			};

			const clock = new THREE.Clock();

			const params = {
				exposure: 1,
				bloomStrength: 1,
				bloomThreshold: 1,
				bloomRadius: 1
			};

			init();
			render();
			//animate();

			function init() {

				const container = document.createElement( 'div' );
				document.body.appendChild( container );

				//Camera

				camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 5000 );
				camera.position.set( - 25, 5, -25 );

				scene = new THREE.Scene();

				// #region Video

				xenoVideo = document.getElementById( 'xenoVideo' );
				artScreen01 = document.getElementById( 'artScreen01' );
				SubstrataScreen = document.getElementById( 'SubstrataScreen' );
				SubstrataScreen001 = document.getElementById( 'SubstrataScreen001' );
				MonaScreen = document.getElementById( 'MonaScreen' );
				MonaScreen001 = document.getElementById( 'MonaScreen001' );
				DecentralandScreen = document.getElementById( 'DecentralandScreen' );
				DecentralandScreen001 = document.getElementById( 'DecentralandScreen001' );
				VoxelsScreen = document.getElementById( 'VoxelsScreen' );
				VoxelsScreen001 = document.getElementById( 'VoxelsScreen001' );
				
						//Main Screen

				let vidPromoTexture = new THREE.VideoTexture( xenoVideo );
				vidPromoTexture.minFilter = THREE.NearestFilter;
				vidPromoTexture.magFilter = THREE.LinearFilter;
				vidPromoTexture.format = THREE.RGBAFormat;

				let vidMaterial   = new THREE.MeshBasicMaterial( { map : vidPromoTexture } );

						//Art 01

				let artScreen01Texture = new THREE.VideoTexture( artScreen01 );
				artScreen01Texture.minFilter = THREE.NearestFilter;
				artScreen01Texture.magFilter = THREE.LinearFilter;
				artScreen01Texture.format = THREE.RGBAFormat;

				let artScreen01Material   = new THREE.MeshBasicMaterial( { map : artScreen01Texture } );

						//Substrata Screen

				let SubstrataScreenTexture = new THREE.VideoTexture( SubstrataScreen );
				SubstrataScreenTexture.minFilter = THREE.NearestFilter;
				SubstrataScreenTexture.magFilter = THREE.LinearFilter;
				SubstrataScreenTexture.format = THREE.RGBAFormat;

				let SubstrataScreenMaterial   = new THREE.MeshBasicMaterial( { map : SubstrataScreenTexture } );

						//Substrata Screen 2

				let SubstrataScreen001Texture = new THREE.VideoTexture( SubstrataScreen001 );
				SubstrataScreen001Texture.minFilter = THREE.NearestFilter;
				SubstrataScreen001Texture.magFilter = THREE.LinearFilter;
				SubstrataScreen001Texture.format = THREE.RGBAFormat;

				let SubstrataScreen001Material   = new THREE.MeshBasicMaterial( { map : SubstrataScreen001Texture } );

						//Mona Screen

				let MonaScreenTexture = new THREE.VideoTexture( MonaScreen );
				MonaScreenTexture.minFilter = THREE.NearestFilter;
				MonaScreenTexture.magFilter = THREE.LinearFilter;
				MonaScreenTexture.format = THREE.RGBAFormat;

				let MonaScreenMaterial   = new THREE.MeshBasicMaterial( { map : MonaScreenTexture } );

						//Mona Screen 2

				let MonaScreen001Texture = new THREE.VideoTexture( MonaScreen001 );
				MonaScreen001Texture.minFilter = THREE.NearestFilter;
				MonaScreen001Texture.magFilter = THREE.LinearFilter;
				MonaScreen001Texture.format = THREE.RGBAFormat;

				let MonaScreen001Material   = new THREE.MeshBasicMaterial( { map : MonaScreen001Texture } );

						//Decentraland Screen

				let DecentralandScreenTexture = new THREE.VideoTexture( DecentralandScreen );
				DecentralandScreenTexture.minFilter = THREE.NearestFilter;
				DecentralandScreenTexture.magFilter = THREE.LinearFilter;
				DecentralandScreenTexture.format = THREE.RGBAFormat;

				let DecentralandScreenMaterial   = new THREE.MeshBasicMaterial( { map : DecentralandScreenTexture } );

						//Decentraland Screen 2

				let DecentralandScreen001Texture = new THREE.VideoTexture( DecentralandScreen001 );
				DecentralandScreen001Texture.minFilter = THREE.NearestFilter;
				DecentralandScreen001Texture.magFilter = THREE.LinearFilter;
				DecentralandScreen001Texture.format = THREE.RGBAFormat;

				let DecentralandScreen001Material   = new THREE.MeshBasicMaterial( { map : DecentralandScreen001Texture } );

						//Voxels Screen

				let VoxelsScreenTexture = new THREE.VideoTexture( VoxelsScreen );
				VoxelsScreenTexture.minFilter = THREE.NearestFilter;
				VoxelsScreenTexture.magFilter = THREE.LinearFilter;
				VoxelsScreenTexture.format = THREE.RGBAFormat;

				let VoxelsScreenMaterial   = new THREE.MeshBasicMaterial( { map : VoxelsScreenTexture } );

						//Voxels Screen 2

				let VoxelsScreen001Texture = new THREE.VideoTexture( VoxelsScreen001 );
				VoxelsScreen001Texture.minFilter = THREE.NearestFilter;
				VoxelsScreen001Texture.magFilter = THREE.LinearFilter;
				VoxelsScreen001Texture.format = THREE.RGBAFormat;

				let VoxelsScreen001Material   = new THREE.MeshBasicMaterial( { map : VoxelsScreen001Texture } );

				// #endregion

				//Environment
				
		

				const rgbeloader = new RGBELoader()
					.setPath( 'textures/equirectangular/' )
					.load( 'GreySky_2K.hdr', function ( texture ) {

						texture.mapping = THREE.EquirectangularReflectionMapping;

						scene.background = texture;
						scene.environment = texture;

						render();
						//animate();

						

						

					} );


			//	cubeRenderTarget = new THREE.WebGLCubeRenderTarget( 256, { format: THREE.RGBFormat, generateMipmaps: true, minFilter: THREE.LinearMipmapLinearFilter } );
			//	cubeRenderTarget.texture.type = THREE.HalfFloatType;

			//	cubeCamera = new THREE.CubeCamera( 5, 10000, cubeRenderTarget );
			//	scene.add( cubeCamera );
			

				//Loader

				const loader = new GLTFLoader().setPath( 'models/glb/' );
					loader.load( 'LanternSite.glb', function ( gltf ) {

					const model = gltf.scene;
					model.position.set( 0, 0, 0 );
					model.scale.set( 3, 3, 3 );

					model.traverse( function ( child ) {

       				   if ( child.isMesh ) {

         				child.material.shading = THREE.SmoothShading;
       		   		    child.castShadow = true;
      			        child.receiveShadow = true;
					 //   child.material.envMap = cubeRenderTarget.texture;	
					 
							// #region Screen Materials

							 if (child.name == "prScreen") {

                                child.material = vidMaterial;

				         	}

							 if (child.name == "ArtScreen01") {

								child.material = artScreen01Material;

							}

							if (child.name == "SubstrataScreen") {

								child.material = SubstrataScreenMaterial;

							}

							if (child.name == "SubstrataScreen001") {

								child.material = SubstrataScreen001Material;

							}

							if (child.name == "MonaScreen") {

								child.material = MonaScreenMaterial;

							}

							if (child.name == "MonaScreen001") {

								child.material = MonaScreen001Material;

							}

							if (child.name == "DecentralandScreen") {

								child.material = DecentralandScreenMaterial;

							}

							if (child.name == "DecentralandScreen001") {

								child.material = DecentralandScreen001Material;

							}

							if (child.name == "VoxelsScreen") {

								child.material = VoxelsScreenMaterial;

							}

							if (child.name == "VoxelsScreen001") {

								child.material = VoxelsScreen001Material;

							}

							// #endregion

							if(child.name == "Cube003"){
								
								var newColor = new THREE.Color(5, 5, 5);
								child.material.color = newColor;
								child.material.tonemapped = false;
								
							}

         				 }});

					scene.add( model );
					

					mixer = new THREE.AnimationMixer( model );
					mixer.clipAction( gltf.animations[ 0 ] ).play();
					mixer.clipAction( gltf.animations[ 1 ] ).play();
					mixer.clipAction( gltf.animations[ 2 ] ).play();
					mixer.clipAction( gltf.animations[ 3 ] ).play();
					mixer.clipAction( gltf.animations[ 4 ] ).play();

					animate();

					} 
					
					);

				//Renderer

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.toneMapping = THREE.LinearToneMapping;
				renderer.toneMappingExposure = params.exposure;
				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.PCFSoftShadowMap;
				renderer.outputEncoding = THREE.sRGBEncoding;
				container.appendChild( renderer.domElement );
				

				//Controls

				const controls = new OrbitControls( camera, renderer.domElement );
				//controls.addEventListener( 'change', render ); // use if there is no animation loop
				controls.minDistance = 3;
				controls.maxDistance = 100;
				controls.target.set( 0, 0, 0 );
				controls.update();

				//Audio

				

				// Probe
				lightProbe = new THREE.LightProbe();
				scene.add( lightProbe );


				//Lights

				scene.add( new THREE.AmbientLight( 0x252525 ) );

				const spotLight = new THREE.SpotLight( 0xffffff, 0.5 );
				spotLight.position.set( 300, 50, 0 );

				spotLight.castShadow = true;

				spotLight.shadow.mapSize.width = 1024;
				spotLight.shadow.mapSize.height = 1024;

				spotLight.shadow.camera.near = 0.1;
				spotLight.shadow.camera.far = 5000;
				spotLight.shadow.camera.fov = 60;

				const topLight = new THREE.PointLight( 0x00ff10, 1 );
				topLight.position.set( 50, 0, 0 );

				const lowLight = new THREE.PointLight( 0xff00eb, 1 );
				lowLight.position.set( -50, 0, 0 );

				const top1Light = new THREE.PointLight( 0xfffe00, 1);
				topLight.position.set( 0, 0, 50 );

				const low1Light = new THREE.SpotLight( 0xE70000, 1, 100, 90);
				lowLight.position.set( 50, 0, -50 );
				

				scene.add( spotLight );
				scene.add( topLight );
				scene.add( lowLight );
			    scene.add( top1Light );
				scene.add( low1Light );
				

				const renderScene = new RenderPass( scene, camera );

				const bloomPass = new UnrealBloomPass( new THREE.Vector2( window.innerWidth, window.innerHeight ), 1.5, 0.4, 0.85 );
				bloomPass.threshold = params.bloomThreshold;
				bloomPass.strength = params.bloomStrength;
				bloomPass.radius = params.bloomRadius;

				composer = new EffectComposer( renderer );
				composer.addPass( renderScene );
				composer.addPass( bloomPass );

				
				window.addEventListener( 'resize', onWindowResize );

				renderer.domElement.addEventListener( 'click', onClick, false );

			}

			function onClick() {
				event.preventDefault();

				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;

				// #region Audio

				const listener = new THREE.AudioListener();
				camera.add( listener );

				const bgm = new THREE.PositionalAudio( listener );

				const audioLoader = new THREE.AudioLoader();
				
				audioLoader.load( 'audio/CO.AG - Cicada 3301.mp3', function( buffer ) {
					bgm.setBuffer( buffer );
					bgm.setRefDistance( 20 );
					bgm.play();
				});

				const audioSphere = new THREE.SphereGeometry( 1, 1, 1 );
				const audioMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff } );
				const audioMesh = new THREE.Mesh( audioSphere, audioMaterial );
				audioMesh.scale.set(0.1, 0.1, 0.1);
				scene.add( audioMesh );

				audioMesh.add( bgm );

				// #endregion


				raycaster.setFromCamera( mouse, camera );

				var intersects = raycaster.intersectObjects( scene.children, true );

				if ( intersects.length > 0 ) {
				    console.log( 'Intersection:', intersects[ 0 ] );
					console.log( intersects[ 0 ].object.name, intersects[ 0 ] );	

					if(intersects[0].object.name=="OpenseaButton_2") {
						window.open('https://opensea.io/collection/the-black-fractal')
					}	

					if(intersects[0].object.name=="TwitterButton_2") {
						window.open('https://twitter.com/theblackfractal')
					}

					if(intersects[0].object.name=="DiscordButton_2") {
						window.open('https://discordapp.com/users/theblackfractal#8976')
					}

					if(intersects[0].object.name=="VoxArmsButton_2") {
						window.open('https://opensea.io/collection/black-fractal-voxels')
					}

					// #region Screens

					//Main Screen

					if(intersects[0].object.name=="prScreen") {

						if(xenoVideoOn == false){

						xenoVideo.play();
						xenoVideo.addEventListener( 'play', function () {

						this.currentTime = 0;

						} );

						xenoVideoOn = true;
						console.log( 'xenoVideoOn' );

						}

						else{

							xenoVideo.pause();

							xenoVideoOn = false;
							console.log( 'xenoVideoOff' );
							
						}
						
					}

					//Art Screen 01

					if(intersects[0].object.name=="ArtScreen01") {

						if(artScreen01On == false){

							artScreen01.play();
							artScreen01.addEventListener( 'play', function () {

						this.currentTime = 0;

						} );

						artScreen01On = true;
						console.log( 'artScreen01On' );

						}

						else{

							artScreen01.pause();

						artScreen01On = false;
						console.log( 'artScreen01Off' );
	
						}

					}

					//Substrata Screen

					if(intersects[0].object.name=="SubstrataScreen") {

						if(SubstrataScreenOn == false){

							SubstrataScreen.play();
							SubstrataScreen.addEventListener( 'play', function () {

								this.currentTime = 0;

							} );

							SubstrataScreenOn = true;
							console.log( 'SubstrataScreenOn' );

						}

						else{

							SubstrataScreen.pause();

							SubstrataScreenOn = false;
							console.log( 'SubstrataScreenOff' );

						}

					}

					//Substrata Screen 2

					if(intersects[0].object.name=="SubstrataScreen001") {

						if(SubstrataScreen001On == false){

							SubstrataScreen001.play();
							SubstrataScreen001.addEventListener( 'play', function () {

								this.currentTime = 0;

							} );

							SubstrataScreen001On = true;
							console.log( 'SubstrataScreen001On' );

						}

						else{

							SubstrataScreen001.pause();

							SubstrataScreen001On = false;
							console.log( 'SubstrataScreen001Off' );

							}

						}

					//Mona Screen

					if(intersects[0].object.name=="MonaScreen") {

						if(MonaScreenOn == false){

							MonaScreen.play();
							MonaScreen.addEventListener( 'play', function () {

							this.currentTime = 0;
						
						} );

						MonaScreenOn = true;
						console.log( 'MonaScreenOn' );

						}

						else{

						MonaScreen.pause();

						MonaScreenOn = false;
						console.log( 'MonaScreenOff' );

						}

					}


					//Mona Screen 2

					if(intersects[0].object.name=="MonaScreen001") {

						if(MonaScreen001On == false){

							MonaScreen001.play();
							MonaScreen001.addEventListener( 'play', function () {
								
							this.currentTime = 0;

							} );

							MonaScreen001On = true;
							console.log( 'MonaScreen001On' );

						}

						else{

							MonaScreen001.pause();

							MonaScreen001On = false;
							console.log( 'MonaScreen001Off' );

						}

					}

					//Decentraland Screen

					if(intersects[0].object.name=="DecentralandScreen") {

						if(DecentralandScreenOn == false){

							DecentralandScreen.play();
							DecentralandScreen.addEventListener( 'play', function () {
								
							this.currentTime = 0;

							} );

							DecentralandScreenOn = true;
							console.log( 'DecentralandScreenOn' );

						}

						else{

							DecentralandScreen.pause();

							DecentralandScreenOn = false;
							console.log( 'DecentralandScreenOff' );

						}

					}

					//Decentraland Screen 2

					if(intersects[0].object.name=="DecentralandScreen001") {

						if(DecentralandScreen001On == false){
							
							DecentralandScreen001.play();
							DecentralandScreen001.addEventListener( 'play', function () {
								
							this.currentTime = 0;
						
							} );
							
							DecentralandScreen001On = true;
							console.log( 'DecentralandScreen001On' );

						}

						else{

							DecentralandScreen001.pause();

							DecentralandScreen001On = false;
							console.log( 'DecentralandScreen001Off' );

						}

					}

					//Voxels Screen

					if(intersects[0].object.name=="VoxelsScreen") {

						if(VoxelsScreenOn == false){

							VoxelsScreen.play();
							VoxelsScreen.addEventListener( 'play', function () {
		
							this.currentTime = 0;

							} );

							VoxelsScreenOn = true;
							console.log( 'VoxelsScreenOn' );

						}

						else{

							VoxelsScreen.pause();

							VoxelsScreenOn = false;
							console.log( 'VoxelsScreenOff' );

						}

					}

					//Voxels Screen 2

					if(intersects[0].object.name=="VoxelsScreen001") {

						if(VoxelsScreen001On == false){

							VoxelsScreen001.play();
							VoxelsScreen001.addEventListener( 'play', function () {

							this.currentTime = 0;

							} );

							VoxelsScreen001On = true;
							console.log( 'VoxelsScreen001On' );

						}

						else{

							VoxelsScreen001.pause();

							VoxelsScreen001On = false;
							console.log( 'VoxelsScreen001Off' );

						}

					}



					// #endregion
				}
			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
				composer.setSize( width, height );

				animate();

			}

			function render() {

				//renderer.render( scene, camera );
				//composer.render();

			}

			function animate() {

					requestAnimationFrame( animate );

					const delta = clock.getDelta();

					mixer.update( delta );

				//	cubeCamera.update( renderer, scene );

					renderer.render( scene, camera );

					composer.render(animate);

					

			}

		</script>

	</body>
</html>